<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>PageFlo Class: Errors</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.doflo.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">PageFlo</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="document.html">document</a></li><li><a href="MutationHandler.html">MutationHandler</a></li><li><a href="PFLO.html">PFLO</a></li><li><a href="PFLO.browser.html">PFLO.browser</a></li><li><a href="PFLO.constants.html">PFLO.constants</a></li><li><a href="PFLO.plugins.html">PFLO.plugins</a></li><li><a href="PFLO.plugins.AutoXHR.html">PFLO.plugins.AutoXHR</a></li><li><a href="PFLO.plugins.BW.html">PFLO.plugins.BW</a></li><li><a href="PFLO.plugins.CACHE_RELOAD.html">PFLO.plugins.CACHE_RELOAD</a></li><li><a href="PFLO.plugins.Clicks.html">PFLO.plugins.Clicks</a></li><li><a href="PFLO.plugins.ConsentInlinedPlugin.html">PFLO.plugins.ConsentInlinedPlugin</a></li><li><a href="PFLO.plugins.Continuity.html">PFLO.plugins.Continuity</a></li><li><a href="PFLO.plugins.CT.html">PFLO.plugins.CT</a></li><li><a href="PFLO.plugins.DFE.html">PFLO.plugins.DFE</a></li><li><a href="PFLO.plugins.DNS.html">PFLO.plugins.DNS</a></li><li><a href="PFLO.plugins.Early.html">PFLO.plugins.Early</a></li><li><a href="PFLO.plugins.Errors.html">PFLO.plugins.Errors</a></li><li><a href="PFLO.plugins.EventTiming.html">PFLO.plugins.EventTiming</a></li><li><a href="PFLO.plugins.GUID.html">PFLO.plugins.GUID</a></li><li><a href="PFLO.plugins.History.html">PFLO.plugins.History</a></li><li><a href="PFLO.plugins.IFrameDelay.html">PFLO.plugins.IFrameDelay</a></li><li><a href="PFLO.plugins.IPv6.html">PFLO.plugins.IPv6</a></li><li><a href="PFLO.plugins.Memory.html">PFLO.plugins.Memory</a></li><li><a href="PFLO.plugins.Mobile.html">PFLO.plugins.Mobile</a></li><li><a href="PFLO.plugins.NavigationTiming.html">PFLO.plugins.NavigationTiming</a></li><li><a href="PFLO.plugins.PaintTiming.html">PFLO.plugins.PaintTiming</a></li><li><a href="PFLO.plugins.ResourceTiming.html">PFLO.plugins.ResourceTiming</a></li><li><a href="PFLO.plugins.RT.html">PFLO.plugins.RT</a></li><li><a href="PFLO.plugins.SPA.html">PFLO.plugins.SPA</a></li><li><a href="PFLO.plugins.TPAnalytics.html">PFLO.plugins.TPAnalytics</a></li><li><a href="PFLO.plugins.UserTiming.html">PFLO.plugins.UserTiming</a></li><li><a href="PFLO.session.html">PFLO.session</a></li><li><a href="PFLO.utils.html">PFLO.utils</a></li><li><a href="PFLO.utils.Compression.html">PFLO.utils.Compression</a></li><li><a href="PFLO_mq.html">PFLO_mq</a></li><li><a href="ProxyXHRImplementation.html">ProxyXHRImplementation</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="events.list.html" class="dropdown-toggle" data-toggle="dropdown">Events<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="document.html#event:onBeforePageFloBeacon">document#event:onBeforePageFloBeacon</a></li><li><a href="document.html#event:onPageFloBeacon">document#event:onPageFloBeacon</a></li><li><a href="document.html#event:onPageFloLoaded">document#event:onPageFloLoaded</a></li><li><a href="PFLO.html#event:beacon">PFLO#event:beacon</a></li><li><a href="PFLO.html#event:before_beacon">PFLO#event:before_beacon</a></li><li><a href="PFLO.html#event:before_early_beacon">PFLO#event:before_early_beacon</a></li><li><a href="PFLO.html#event:before_unload">PFLO#event:before_unload</a></li><li><a href="PFLO.html#event:click">PFLO#event:click</a></li><li><a href="PFLO.html#event:config">PFLO#event:config</a></li><li><a href="PFLO.html#event:dom_loaded">PFLO#event:dom_loaded</a></li><li><a href="PFLO.html#event:error">PFLO#event:error</a></li><li><a href="PFLO.html#event:form_submit">PFLO#event:form_submit</a></li><li><a href="PFLO.html#event:netinfo">PFLO#event:netinfo</a></li><li><a href="PFLO.html#event:page_load_beacon">PFLO#event:page_load_beacon</a></li><li><a href="PFLO.html#event:page_ready">PFLO#event:page_ready</a></li><li><a href="PFLO.html#event:page_unload">PFLO#event:page_unload</a></li><li><a href="PFLO.html#event:prerender_to_visible">PFLO#event:prerender_to_visible</a></li><li><a href="PFLO.html#event:rage_click">PFLO#event:rage_click</a></li><li><a href="PFLO.html#event:spa_cancel">PFLO#event:spa_cancel</a></li><li><a href="PFLO.html#event:spa_init">PFLO#event:spa_init</a></li><li><a href="PFLO.html#event:spa_navigation">PFLO#event:spa_navigation</a></li><li><a href="PFLO.html#event:visibility_changed">PFLO#event:visibility_changed</a></li><li><a href="PFLO.html#event:xhr_error">PFLO#event:xhr_error</a></li><li><a href="PFLO.html#event:xhr_init">PFLO#event:xhr_init</a></li><li><a href="PFLO.html#event:xhr_load">PFLO#event:xhr_load</a></li><li><a href="PFLO.html#event:xhr_send">PFLO#event:xhr_send</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-README.template.html">README.template</a></li><li><a href="tutorial-building.html">Building</a></li><li><a href="tutorial-contributing.html">Contributing</a></li><li><a href="tutorial-creating-plugins.html">Creating Plugins</a></li><li><a href="tutorial-header-snippets.html">Header Snippets</a></li><li><a href="tutorial-howtos.html">How-Tos</a></li><li><a href="tutorial-loader-snippet.html">Non-Blocking Loader Snippet</a></li><li><a href="tutorial-methodology.html">Methodology</a></li><li><a href="tutorial-page-overrides.html">Page Overrides</a></li><li><a href="tutorial-perf-tests.html">Performance Tests</a></li><li><a href="tutorial-tests.html">Tests</a></li><li><a href="tutorial-version-history.html">Version History</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#PFLO_check_doc_domain">PFLO_check_doc_domain</a></li><li><a href="global.html#PFLO_lstart">PFLO_lstart</a></li><li><a href="global.html#PFLO_onload">PFLO_onload</a></li><li><a href="global.html#PFLO_start">PFLO_start</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-8">
	
		<div id="main">
			


    
    <section>

    <header>
        
            <h1>
                <span class="ancestors"><a href="PFLO.html">PFLO</a><a href="PFLO.plugins.html">.plugins</a>.</span>
            
            Errors
            </h1>
            
        
    </header>


    <article>
        <div class="container-overview">
        
            
<hr>
<dt>
    

    
</dt>
<dd>

    
    <div class="description">
        <p>The <code>Errors</code> plugin automatically captures JavaScript and other errors from
your web application.</p>
<p>This plugin has a corresponding <a href="tutorial-header-snippets.html">Header Snippets</a> that helps capture errors prior to PageFlo loading.</p>
<p>For information on how to include this plugin, see the <a href="tutorial-building.html">Building</a> tutorial.</p>
<h2>Sources of Errors</h2>
<p>When the <code>Errors</code> plugin is enabled, the following sources of errors are captured:</p>
<ul>
<li>JavaScript runtime errors captured via the
<a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onerror"><code>onerror</code></a>
global event handler</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest"><code>XMLHttpRequest</code></a>
responses that were not successful.  Note <a href="PFLO.plugins.AutoXHR.html"><code>PFLO.plugins.AutoXHR</code></a> is required
if using this.</li>
<li>Any calls to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Console/error"><code>window.console.error</code></a></li>
<li>JavaScript runtime errors that happen during a callback for
<a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener"><code>addEventListener</code></a>
<em>(disabled by default, enabled via <a href="PFLO.plugins.Errors.html#.init"><code><code>monitorEvents</code></code></a>)</em></li>
<li>JavaScript runtime errors that happen during a callback for
<a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout"><code>setTimeout</code></a>
and <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setInterval"><code>setInterval</code></a>
<em>(disabled by default, enabled via <a href="PFLO.plugins.Errors.html#.init"><code><code>monitorTimeout</code></code></a>)</em></li>
<li>Manually sent errors via <a href="PFLO.plugins.Errors.html#.send"><code>PFLO.plugins.Errors.send</code></a></li>
<li>Functions that threw an exception that were wrapped via <a href="PFLO.plugins.Errors.html#.wrap"><code>PFLO.plugins.Errors.wrap</code></a></li>
<li>Functions that threw an exception that were run via <a href="PFLO.plugins.Errors.html#.test"><code>PFLO.plugins.Errors.test</code></a></li>
<li>JavaScript runtime errors captured via the
<a href="https://developer.mozilla.org/en-US/docs/Web/Events/unhandledrejection"><code>unhandledrejection</code></a>
global event handler <em>(disabled by default, enabled via <a href="PFLO.plugins.Errors.html#.init"><code><code>monitorRejections</code></code></a>)</em></li>
<li>JavaScript runtime warnings captured via the
<a href="https://www.w3.org/TR/reporting/#reporting-observer"><code>Reporting API</code></a>
<em>(disabled by default, enabled via <a href="PFLO.plugins.Errors.html#.init"><code><code>monitorReporting</code></code></a>)</em></li>
</ul>
<p>All of the options above can be
<a href="PFLO.plugins.Errors.html#.init"><code>manually turned off</code></a>.</p>
<h2>Supported Browsers</h2>
<p>The <code>Errors</code> plugin can be enabled for all browsers, though some older browsers
may not be able to capture the full breadth of sources of errors. Due to the lack
of error detail on some older browsers, some errors may be reported more than once.</p>
<p>Notable browsers:</p>
<ul>
<li>Internet Explorer &lt;= 8: Does not support capturing <code>XMLHttpRequest</code> errors.</li>
</ul>
<h2>Manually Sending Errors</h2>
<p>Besides automatically capturing errors from <code>onerror</code>, <code>XMLHttpRequest</code>,
<code>console.error</code> or event handlers such as <code>setTimeout</code>, you can also manually
send errors.</p>
<p>There are three ways of doing this as follows:</p>
<ul>
<li><a href="PFLO.plugins.Errors.html#.send"><code>PFLO.plugins.Errors.send</code></a>: Immediately sends an error.</li>
<li><a href="PFLO.plugins.Errors.html#.wrap"><code>PFLO.plugins.Errors.wrap</code></a>: Wraps a function with error tracking</li>
<li><a href="PFLO.plugins.Errors.html#.test"><code>PFLO.plugins.Errors.test</code></a>: Runs the function and captures any errors.</li>
</ul>
<h2>Error callback</h2>
<p>You can specify an <a href="PFLO.plugins.Errors.html#.init"><code><code>onError</code></code></a> function that
the Errors plugin will call any time an error is captured on the page.</p>
<p>If your <code>onError</code> function returns <code>true</code>, the error will be captured.</p>
<p>If your <code>onError</code> function does not return <code>true</code>, the error will be ignored.</p>
<p>Example:</p>
<pre class="prettyprint source"><code>PFLO.init({
  Errors: {
    onError: function(err) {
      if (err.message && err.message.indexOf(&quot;internally handled&quot;)) {
        return false;
      }
      return true;
    }
  }
});
</code></pre>
<h2>When to Send Errors</h2>
<p>By default, errors captured during the page load will be sent along with the
page load beacon.</p>
<p>Errors that happen after the page load will not be captured or sent.</p>
<p>To enable capturing of errors after page load, you need to set
<a href="PFLO.plugins.Errors.html#.init"><code><code>sendAfterOnload</code></code></a> to <code>true</code>. If set,
errors that happen after the page load will be sent at most once every
<a href="PFLO.plugins.Errors.html#.init"><code><code>sendInterval</code></code></a> (which defaults to 1 second)
on a new beacon.</p>
<p>Example:</p>
<pre class="prettyprint source"><code>PFLO.init({
  Errors: {
    sendAfterOnload: true,
    sendInterval: 5000
  }
});
</code></pre>
<h2>How Many Errors to Capture</h2>
<p>The <code>Errors</code> plugin will only capture up to
<a href="PFLO.plugins.Errors.html#.init"><code><code>maxErrors</code></code></a> (defaults to 10) distinct
errors on the page.</p>
<p>Please note that duplicate errors (those with the same function name, stack,
and so on) are tracked as single distinct error, with a <code>count</code> of how many
times it was seen.</p>
<p>You can increase (or decrease) <code>maxErrors</code>. For example:</p>
<pre class="prettyprint source"><code>PFLO.init({
  Errors: {
    maxErrors: 20
  }
});
</code></pre>
<h2>Dealing with Script Error</h2>
<p>When looking at JavaScript errors, you will likely come across the generic error
message: <code>Script error.</code></p>
<p><code>Script Error.</code> is the message that browsers send to the
<a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onerror"><code>window.onerror</code></a>
global exception handler when the error was triggered by a script loaded from a different (cross)
<a href="https://developer.mozilla.org/en-US/docs/Glossary/Origin">origin</a>.  <code>window.onerror</code>
is used by PageFlo so that it gets notified of all unhandled exceptions.</p>
<p>The <code>Script Error.</code> string is given <em>instead</em> of the real error message
and does not contain any useful information about what caused the error. In addition,
there is no stack associated with the message, so it's impossible to know where
or why the error occurred.</p>
<p>Browsers mask the real error message for cross-origin scripts due to security and
privacy concerns - they don't want to leak sensitive information in the message
or stack.  The only thing that <code>window.onerror</code> knows for cross-origin scripts
is that an error occurred, not where or why.</p>
<h3>Example</h3>
<p>For an example of where you'd see <code>Script Error.</code>, consider the following code
that lives on <code>website.com</code>:</p>
<pre class="prettyprint source lang-html"><code>&lt;html>
    &lt;head>
        &lt;title>website.com&lt;/title>
    &lt;/head>
    &lt;body>
        &lt;script>
            window.onerror = function(message, url, line, column, error) {
                console.log(&quot;window.onerror: &quot; + message);
                console.log((error && error.stack) ? error.stack : &quot;(no stack)&quot;);
            };
        &lt;/script>
        &lt;script src=&quot;my-script.js&quot;>&lt;/script>
        &lt;script src=&quot;https://anothersite.com/my-script.js&quot;>&lt;/script>
    &lt;/body>
&lt;/html>
</code></pre>
<p>Assume <code>my-script.js</code> is the same file being served from both <code>website.com</code> and
<code>anothersite.com</code>:</p>
<pre class="prettyprint source lang-javascript"><code>function runCode() {
    a = b + 1;
}

runCode();
</code></pre>
<p>When <code>my-script.js</code> is loaded from <code>website.com</code>, it will be executed twice:</p>
<ol>
<li>
<p>First on the same-origin, where we'll see the full error message followed by
the stack:</p>
<pre class="prettyprint source"><code>window.onerror: Uncaught ReferenceError: b is not defined

ReferenceError: b is not defined
    at runCode (my-script.js:2)
    at my-script.js:5
</code></pre>
</li>
<li>
<p>Then, it will be loaded from <code>https://anothersite.com/my-script.js</code>, which
will be considered cross-origin and only <code>Script Error.</code> will be logged:</p>
<pre class="prettyprint source"><code>window.onerror: Script error.

(no stack)
</code></pre>
</li>
</ol>
<p>As you can see, browser shares the full details of the exception when it's served
from the same origin as the website, but if it's served from any other origin,
it will be considered cross-origin and no details will be shared.</p>
<p>Note that while the browser only shares <code>Script Error.</code> to <code>window.onerror</code>
for cross-origin scripts, if <em>you</em> have browser developer tools open,
the browser will show <em>you</em> the full error message in the Console.  This is
because there aren't any security or privacy concerns for a developer looking at
their own machine's information.</p>
<h3>When You'll See Script Error</h3>
<p>Unfortunately <code>Script Error.</code> will be shown in many legitimate use-cases,
such as:</p>
<ol>
<li>
<p>When serving your website's JavaScript from a CDN (since it will be coming
from a different origin)</p>
</li>
<li>
<p>When loading a library such as jQuery or Angular from their CDN, i.e.
<a href="https://developers.google.com/speed/libraries/">Google's Hosted Libraries</a>
or <a href="https://cdnjs.com/">cdnjs</a></p>
</li>
<li>
<p>When a third-party script loads from another domain</p>
</li>
</ol>
<p>The good news is that in many of these cases, there are changes you can make to
ensure the full error message and stack are shared with <code>window.onerror</code>.</p>
<h3>Fixing Script Error</h3>
<p>To ensure a cross-origin script shares full error details with <code>window.onerror</code>,
you'll need to do <strong>two</strong> things:</p>
<ol>
<li>
<p>Add <code>crossorigin=&quot;anonymous&quot;</code> to the <code>&lt;script&gt;</code> tag</p>
<p>The <a href="https://www.w3.org/TR/html5/infrastructure.html#cors-settings-attribute"><code>crossorigin=&quot;anonymous&quot;</code> attribute</a>
tells the browser that the script should be fetched without sending
any cookies or HTTP authentication</p>
</li>
<li>
<p>Add the <code>Access-Control-Allow-Origin</code> (ACAO) header to the JavaScript file's response.</p>
<p>The <code>Access-Control-Allow-Origin</code> header is part of the
<a href="https://www.w3.org/TR/cors/">Cross Origin Resource Sharing</a> (CORS) standard.</p>
<p>The ACAO header <strong>must</strong> be set in the JavaScript's HTTP response headers.</p>
<p>An example header that sets ACAO for all calling origins would be:</p>
<p><code>Access-Control-Allow-Origin: *</code></p>
</li>
</ol>
<p>If both conditions are true, cross-origin JavaScript files will report errors
to <code>window.onerror</code> with the correct error message and full stack.</p>
<p>The biggest challenge to getting this working is that (1) is within the <em>site's</em>
control while (2) can only be configured by the <em>owner</em> of the JavaScript.  If you're
loading JavaScript from a third-party, you will need to encourage them to add the
ACAO header if it's not already set.  The good news is that many CDNs and
third-parties set the ACAO header already.</p>
<h3>Workarounds for Third Parties that aren't sending ACAO</h3>
<p>One way to help monitor for errors coming from third-party scripts that aren't
setting ACAO (and aren't within your control) is by manually wrapping calls
to any of the third-party script's functions in a <code>try {} catch {}</code>.</p>
<pre class="prettyprint source lang-javascript"><code>try {
    // calls a cross-origin script that doesn't have ACAO
    runThirdPartyCode();
} catch (e) {
    // report on error with e.message and e.stack
}
</code></pre>
<p>If <code>runThirdPartyCode()</code> causes any errors, the <code>catch {}</code> handler will get the full
details of the exception.</p>
<p>Unfortunately this won't work for functions that are executed in the third-party
script as a result of browser events or callbacks (since you're not wrapping them).</p>
<p>When using PageFlo to monitor JavaScript errors, PageFlo automatically wraps some
of the built-in browser APIs such as <code>setTimeout</code>, <code>setInterval</code>
(via the <a href="PFLO.plugins.Errors.html#.init"><code><code>monitorTimeout</code></code></a> option)
and <code>addEventListener</code> (via the <a href="PFLO.plugins.Errors.html#.init"><code><code>monitorEvents</code></code></a> option)
with a minimal-overhead wrapper.  It does this to help ensure as many cross-origin
exceptions as possible have full stack details. You may also do this manually via
<a href="#PFLO_plugin_Errors_wrap"><code> PFLO.plugin.Errors.wrap(function)</code></a>.</p>
<p>Note that enabling <a href="PFLO.plugins.Errors.html#.init"><code><code>monitorTimeout</code></code></a> or
<a href="PFLO.plugins.Errors.html#.init"><code><code>monitorEvents</code></code></a> can have side-effects and has caused
compatibility issues with JavaScript code on some sites. Enabling those options is only
recommended after verifying there are no problems.</p>
<h2>Why is PageFlo in my Error Stack?</h2>
<p>When looking at error reports, you may find errors that have a function in
<code>pflo.js</code> (or <code>/pflo/</code>) on the stack.  Why is that?  Is PageFlo
causing errors on your site?</p>
<p>One of the ways that PageFlo is able to monitor and measure your site's performance
is by <em>wrapping</em> itself around some of the core browser APIs.  PageFlo only does
this in a few places, if absolutely necessary -- namely, when the browser doesn't
provide a native &quot;monitoring&quot; interface for something that needs to be tracked.</p>
<p>One example is for <code>XMLHttpRequests</code>, as there are no browser APIs to monitor when
XHRs load.  To monitor XHRs, PageFlo swaps in its own <code>window.XMLHttpRequest</code>
object, wrapping around the native methods.  When an XHR is created (via <code>.open()</code>),
the lightweight PageFlo wrapper is executed first so it can log a start timestamp.
When the XHR finishes (via a <code>readyState</code> change), PageFlo can log the end
timestamp and report on the XHR's performance.</p>
<p>Examples of PageFlo wrapping native methods include:</p>
<ul>
<li><code>XMLHttpRequest</code> if the XHR instrumentation is turned on</li>
<li><code>console.error</code> if error tracking is turned on</li>
<li><code>setTimeout</code> and <code>setInterval</code>(if error tracking is turned on
(with <a href="PFLO.plugins.Errors.html#.init"><code><code>monitorTimeout</code></code></a>)</li>
<li><code>addEventListener</code> and <code>removeEventListener</code> (if error tracking is turned on
(with <a href="PFLO.plugins.Errors.html#.init"><code><code>monitorEvents</code></code></a>)</li>
</ul>
<p>All of these wrapped functions come into play when you see an error stack with
a <code>pflo.js</code> function in it.</p>
<p>Often, the <code>pflo.js</code> function will be at the <em>bottom</em> of the stack (the first
function called).  This does not mean PageFlo caused the error, merely that
the monitoring code was running before the error occurred.  The actual
error happens towards the <em>top</em> of the stack -- the function that ran and threw
the exception.</p>
<p>Let's look at some examples:</p>
<pre class="prettyprint source"><code>Cannot read property 'foo' of undefined at thirdPartyTwo (https://thirdparty.com/core.js:1:100)
at thirdPartyOne (https://thirdparty.com/core.js:1:101)
at runThirdParty (https://thirdparty.com/core.js:1:102)
at xhrCallback (http://website.com/site.js:2:200)
at XMLHttpRequest.send (https://mysite.com/pflo.js:3:300)
</code></pre>
<p>In the above example, PageFlo is monitoring <code>XMLHttpRequests</code>.  An XHR was
loaded on the site, and during the XHR callback, an exception was thrown.  Even
though <code>/pflo/</code> is listed here, the error was caused by code in the XHR
callback (<code>xhrCallback</code> eventually calling <code>thirdPartyTwo</code>).</p>
<p>Here's a second example:</p>
<pre class="prettyprint source"><code>Reference error: a is not defined at setTimeout (http://website.com/site.js:1:200)
at PFLO_plugins_errors_wrap (http://mysite.com/pflo.js:3:300)
at onclick (http://website.com/site.js:1:100)
</code></pre>
<p>In the above example, JavaScript Error Reporting is enabled and an exception was
thrown in a <code>setTimeout()</code> on the website.  You can see the <code>PFLO_plugins_errors_wrap</code>
function is near the top of the stack, but this is merely the error tracking code.
All it did was wrap <code>setTimeout</code> to help ensure that cross-origin exceptions are
caught.  It was not the actual cause of the site's error.</p>
<p>Here's a third example:</p>
<pre class="prettyprint source"><code>Error: missing argument 1 at PFLO.window.console.error (https://mysite.com/pflo.js:3:300)
at u/&lt; (https://website.com/site.js:1:100)
at tp/this.$get&lt;/&lt; (https://website.com/site.js:1:200)
at $digest (https://website.com/site.js:1:300)
at $apply (https://website.com/site.js:1:400)
at ut (https://website.com/site.js:1:500)
at it (https://website.com/site.js:1:600)
at vp/&lt;/k.onload (https://website.com/site.js:1:700)
</code></pre>
<p>In the above example, JavaScript Error Reporting is enabled and has wrapped
<code>console.error</code>.  The minified function <code>u/&lt;</code> must be logging a <code>console.error</code>,
which executes the PageFlo wrapper code, reporting the error.</p>
<p>In summary, if you see PageFlo functions in error stacks similar to any of the
ones listed below, it's probable that you're just seeing a side-effect of the
monitoring code:</p>
<ul>
<li><code>PFLO_addError</code></li>
<li><code>PFLO_plugins_errors_onerror</code></li>
<li><code>PFLO_plugins_errors_onxhrerror</code></li>
<li><code>PFLO_plugins_errors_console_error</code></li>
<li><code>PFLO_plugins_errors_wrap</code></li>
<li><code>PFLO.window.console.error</code></li>
<li><code>PFLO_plugins_errors_onrejection</code></li>
</ul>
<h2>Side Effects</h2>
<p>Enabling wrapping through <a href="PFLO.plugins.Errors.html#.init"><code><code>monitorEvents</code></code></a> and
<a href="PFLO.plugins.Errors.html#.init"><code><code>monitorTimeout</code></code></a> may trigger some side effects:</p>
<ul>
<li>PageFlo's monitoring code will be run first for every callback, which will add minimal (though non-zero)
overhead.</li>
<li>In browser console logs, errors that are triggered by other libraries that have been wrapped
will now look like they come from PageFlo instead, as PageFlo is now on the bottom of the call stack.</li>
<li>Browser developer tools such as Chrome's Performance and Profiler tabs may be confused about
JavaScript CPU attribution. In other words, they may think PageFlo is the cause of more work than it is.</li>
<li>Chrome Lighthouse may be confused about JavaScript CPU attribution, due to the same reasons as above.</li>
<li>WebPagetest may be confused about JavaScript CPU attribution, due to the same reasons as above.</li>
<li>There are some cases where JavaScript applications may have compatibility issues with the wrapping.  Some
notable cases include:
<ul>
<li>Use of the global <code>window.event</code> object, <a href="https://github.com/whatwg/dom/issues/735">see issue</a>.</li>
<li>Other libraries that wrap <code>setTimeout</code>, <code>addEventListener</code>, etc such as <code>history.js</code>.</li>
<li>Pages that use the <code>&lt;base href=&quot;...&quot;&gt;</code> tag.</li>
</ul>
</li>
</ul>
<p>For more details, you can read this <a href="https://nicj.net/side-effects-of-pflos-javascript-error-tracking/">article</a>.</p>
<h2>Beacon Parameters</h2>
<ul>
<li><code>err</code>: The compressed error data structure</li>
<li><code>http.initiator = error</code> (if not part of a Page Load beacon)</li>
</ul>
<p>The compressed error data structure is a <a href="https://github.com/Sage/jsurl">JSURL</a>
encoded JSON object.</p>
<p>Each element in the array is a compressed representation of a JavaScript error:</p>
<ul>
<li><code>n</code>: Count (if the error was seen more than once)</li>
<li><code>f[]</code>: An array of frames
<ul>
<li><code>f[].l</code>: Line number</li>
<li><code>f[].c</code>: Colum number</li>
<li><code>f[].f</code>: Function name</li>
<li><code>f[].w</code>: File name (if origin differs from root page)</li>
<li><code>f[].wo</code>: File name without origin (if same as root page)</li>
</ul>
</li>
<li><code>s</code>: Source:
<ul>
<li><code>1</code>: Error was triggered by the application</li>
<li><code>2</code>: Error was triggered by PageFlo</li>
</ul>
</li>
<li><code>v</code>: Via
<ul>
<li><code>1</code>: Application (<a href="PFLO.plugins.Errors.html#.send"><code>PFLO.plugins.Errors.send</code></a>)</li>
<li><code>2</code>: Global exception handler (<code>window.onerror</code>)</li>
<li><code>3</code>: Network (XHR) error</li>
<li><code>4</code>: Console (<code>console.error</code>)</li>
<li><code>5</code>: Event handler (<code>addEventListener</code>)</li>
<li><code>6</code>: <code>setTimeout</code> or <code>setInterval</code></li>
</ul>
</li>
<li><code>t</code>: Type (e.g. <code>SyntaxError</code> or <code>ReferenceError</code>)</li>
<li><code>c</code>: Code (for network errors)</li>
<li><code>m</code>: Error messag</li>
<li><code>x</code>: Extra data</li>
<li><code>d</code>: Timestamp (base 36)</li>
</ul>
    </div>
    

    

    

    
    

    
<dl class="details">
    

	

	

	

    

    

    

    

	

	

	

	

	

	

	

	

	
</dl>


    

    

    

    

    

    

    
</dd>

        
        </div>

        

        

        

        

        

        

        
            <h2 class="subsection-title">Methods</h2>

            <dl>
                
<hr>
<dt>
    
        <h3 class="method-name" class="name" id=".init">init(config)</h3>
    

    
</dt>
<dd>

    
    <div class="description">
        <p>Initializes the plugin.</p>
    </div>
    

    

    

    
    
        <h4>Parameters:</h4>
        

<table class="params table table-striped">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>config</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>Configuration</p>
                <h5 class="method-params-label method-subparams-label">Properties</h5>
                

<table class="params table table-striped">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Argument</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>Errors.onError</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Callback to fire when
an error occurs</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>Errors.monitorGlobal</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Monitor <code>window.onerror</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>Errors.monitorNetwork</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Monitor XHR errors</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>Errors.monitorConsole</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Monitor <code>console.error</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>Errors.monitorEvents</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Monitor event callbacks
(from <code>addEventListener</code>). NOTE: Enabling this may cause compatibility issues with certain sites.
Verifications should be run before enabling in production.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>Errors.monitorTimeout</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Monitor <code>setTimout</code>
and <code>setInterval</code>. NOTE: Enabling this may cause compatibility issues with certain sites.
Verifications should be run before enabling in production.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>Errors.monitorRejections</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Monitor unhandled
promise rejections.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>Errors.monitorReporting</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Monitor Reporting API
warnings.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>Errors.sendAfterOnload</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Whether or not to
send errors after the page load beacon.  If set to false, only errors
that happened up to the page load beacon will be captured.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>Errors.sendInterval</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>If <code>sendAfterOnload</code> is
true, how often to send the latest batch of errors.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>Errors.maxErrors</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Maximum number of errors
to track per page.</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>

    

    
<dl class="details">
    

	

	

	

    

    

    

    

	

	

	

	

	

	

	

	

	
</dl>


    

    

    

    

    

    
    <h4>Returns:</h4>
    <div class="method-returns">
        
                
<div class="param-desc">
    <p><a href="PFLO.plugins.Errors.html"><code>PFLO.plugins.Errors</code></a> The Errors plugin for chaining</p>
</div>


            
    </div>
    

    
</dd>

            
                
<hr>
<dt>
    
        <h3 class="method-name" class="name" id=".is_complete">is_complete()</h3>
    

    
</dt>
<dd>

    
    <div class="description">
        <p>This plugin is always complete (ready to send a beacon)</p>
    </div>
    

    

    

    
    

    
<dl class="details">
    

	

	

	

    

    

    

    

	

	

	

	

	

	

	

	

	
</dl>


    

    

    

    

    

    
    <h4>Returns:</h4>
    <div class="method-returns">
        
                
    <p>Type: 
<span class="param-type">boolean</span>


</p>

<div class="param-desc">
    <p><code>true</code></p>
</div>


            
    </div>
    

    
</dd>

            
                
<hr>
<dt>
    
        <h3 class="method-name" class="name" id=".is_supported">is_supported()</h3>
    

    
</dt>
<dd>

    
    <div class="description">
        <p>Determines if Error tracking is initialized.</p>
    </div>
    

    

    

    
    

    
<dl class="details">
    

	

	

	

    

    

    

    

	

	

	

	

	

	

	

	

	
</dl>


    

    

    

    

    

    
    <h4>Returns:</h4>
    <div class="method-returns">
        
                
    <p>Type: 
<span class="param-type">boolean</span>


</p>

<div class="param-desc">
    <p><code>true</code></p>
</div>


            
    </div>
    

    
</dd>

            
                
<hr>
<dt>
    
        <h3 class="method-name" class="name" id=".send">send(error)</h3>
    

    
</dt>
<dd>

    
    <div class="description">
        <p>Sends an error</p>
    </div>
    

    

    

    
    
        <h4>Parameters:</h4>
        

<table class="params table table-striped">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>error</code></td>
            

            <td class="type">
            
                
<span class="param-type">Error</span>
|

<span class="param-type">String</span>



            
            </td>

            

            

            <td class="description last"><p>Error object or message</p></td>
        </tr>

    
    </tbody>
</table>

    

    
<dl class="details">
    

	

	

	

    

    

    

    

	

	

	

	

	

	

	

	

	
</dl>


    

    

    

    

    

    

    
</dd>

            
                
<hr>
<dt>
    
        <h3 class="method-name" class="name" id=".test">test(fn, that, args)</h3>
    

    
</dt>
<dd>

    
    <div class="description">
        <p>Runs the function, watching for exceptions</p>
    </div>
    

    

    

    
    
        <h4>Parameters:</h4>
        

<table class="params table table-striped">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>fn</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>Function</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>that</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>Target object</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>args</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;object></span>



            
            </td>

            

            

            <td class="description last"><p>Arguments</p></td>
        </tr>

    
    </tbody>
</table>

    

    
<dl class="details">
    

	

	

	

    

    

    

    

	

	

	

	

	

	

	

	

	
</dl>


    

    

    

    

    

    

    
</dd>

            
                
<hr>
<dt>
    
        <h3 class="method-name" class="name" id=".wrap">wrap(fn, that, via)</h3>
    

    
</dt>
<dd>

    
    <div class="description">
        <p>Wraps the function in an exception handler that will
automatically report exceptions.</p>
    </div>
    

    

    

    
    
        <h4>Parameters:</h4>
        

<table class="params table table-striped">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>fn</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>Function</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>that</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>Target object</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>via</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>



            
            </td>

            

            

            <td class="description last"><p>Via (optional)</p></td>
        </tr>

    
    </tbody>
</table>

    

    
<dl class="details">
    

	

	

	

    

    

    

    

	

	

	

	

	

	

	

	

	
</dl>


    

    

    

    

    

    
    <h4>Returns:</h4>
    <div class="method-returns">
        
                
    <p>Type: 
<span class="param-type">function</span>


</p>

<div class="param-desc">
    <p>Wrapped function</p>
</div>


            
    </div>
    

    
</dd>

            </dl>
        

        

        
    </article>

    </section>




		</div>
	</div>

	<div class="clearfix"></div>

	
		<div class="col-md-3">
			<div id="toc" class="col-md-3 hidden-xs hidden-sm hidden-md"></div>
		</div>
	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	© 2010-2021 doFlo, Inc.
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a>
	
		on Fri Aug 13th 2021
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>