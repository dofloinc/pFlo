<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>PageFlo Tutorial: Reading data from a beacon</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.doflo.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">PageFlo</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="document.html">document</a></li><li><a href="MutationHandler.html">MutationHandler</a></li><li><a href="PFLO.html">PFLO</a></li><li><a href="PFLO.browser.html">PFLO.browser</a></li><li><a href="PFLO.constants.html">PFLO.constants</a></li><li><a href="PFLO.plugins.html">PFLO.plugins</a></li><li><a href="PFLO.plugins.AutoXHR.html">PFLO.plugins.AutoXHR</a></li><li><a href="PFLO.plugins.BW.html">PFLO.plugins.BW</a></li><li><a href="PFLO.plugins.CACHE_RELOAD.html">PFLO.plugins.CACHE_RELOAD</a></li><li><a href="PFLO.plugins.Clicks.html">PFLO.plugins.Clicks</a></li><li><a href="PFLO.plugins.ConsentInlinedPlugin.html">PFLO.plugins.ConsentInlinedPlugin</a></li><li><a href="PFLO.plugins.Continuity.html">PFLO.plugins.Continuity</a></li><li><a href="PFLO.plugins.CT.html">PFLO.plugins.CT</a></li><li><a href="PFLO.plugins.DFE.html">PFLO.plugins.DFE</a></li><li><a href="PFLO.plugins.DNS.html">PFLO.plugins.DNS</a></li><li><a href="PFLO.plugins.Early.html">PFLO.plugins.Early</a></li><li><a href="PFLO.plugins.Errors.html">PFLO.plugins.Errors</a></li><li><a href="PFLO.plugins.EventTiming.html">PFLO.plugins.EventTiming</a></li><li><a href="PFLO.plugins.GUID.html">PFLO.plugins.GUID</a></li><li><a href="PFLO.plugins.History.html">PFLO.plugins.History</a></li><li><a href="PFLO.plugins.IFrameDelay.html">PFLO.plugins.IFrameDelay</a></li><li><a href="PFLO.plugins.IPv6.html">PFLO.plugins.IPv6</a></li><li><a href="PFLO.plugins.Memory.html">PFLO.plugins.Memory</a></li><li><a href="PFLO.plugins.Mobile.html">PFLO.plugins.Mobile</a></li><li><a href="PFLO.plugins.NavigationTiming.html">PFLO.plugins.NavigationTiming</a></li><li><a href="PFLO.plugins.PaintTiming.html">PFLO.plugins.PaintTiming</a></li><li><a href="PFLO.plugins.ResourceTiming.html">PFLO.plugins.ResourceTiming</a></li><li><a href="PFLO.plugins.RT.html">PFLO.plugins.RT</a></li><li><a href="PFLO.plugins.SPA.html">PFLO.plugins.SPA</a></li><li><a href="PFLO.plugins.TPAnalytics.html">PFLO.plugins.TPAnalytics</a></li><li><a href="PFLO.plugins.UserTiming.html">PFLO.plugins.UserTiming</a></li><li><a href="PFLO.session.html">PFLO.session</a></li><li><a href="PFLO.utils.html">PFLO.utils</a></li><li><a href="PFLO.utils.Compression.html">PFLO.utils.Compression</a></li><li><a href="PFLO_mq.html">PFLO_mq</a></li><li><a href="ProxyXHRImplementation.html">ProxyXHRImplementation</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="events.list.html" class="dropdown-toggle" data-toggle="dropdown">Events<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="document.html#event:onBeforePageFloBeacon">document#event:onBeforePageFloBeacon</a></li><li><a href="document.html#event:onPageFloBeacon">document#event:onPageFloBeacon</a></li><li><a href="document.html#event:onPageFloLoaded">document#event:onPageFloLoaded</a></li><li><a href="PFLO.html#event:beacon">PFLO#event:beacon</a></li><li><a href="PFLO.html#event:before_beacon">PFLO#event:before_beacon</a></li><li><a href="PFLO.html#event:before_early_beacon">PFLO#event:before_early_beacon</a></li><li><a href="PFLO.html#event:before_unload">PFLO#event:before_unload</a></li><li><a href="PFLO.html#event:click">PFLO#event:click</a></li><li><a href="PFLO.html#event:config">PFLO#event:config</a></li><li><a href="PFLO.html#event:dom_loaded">PFLO#event:dom_loaded</a></li><li><a href="PFLO.html#event:error">PFLO#event:error</a></li><li><a href="PFLO.html#event:form_submit">PFLO#event:form_submit</a></li><li><a href="PFLO.html#event:netinfo">PFLO#event:netinfo</a></li><li><a href="PFLO.html#event:page_load_beacon">PFLO#event:page_load_beacon</a></li><li><a href="PFLO.html#event:page_ready">PFLO#event:page_ready</a></li><li><a href="PFLO.html#event:page_unload">PFLO#event:page_unload</a></li><li><a href="PFLO.html#event:prerender_to_visible">PFLO#event:prerender_to_visible</a></li><li><a href="PFLO.html#event:rage_click">PFLO#event:rage_click</a></li><li><a href="PFLO.html#event:spa_cancel">PFLO#event:spa_cancel</a></li><li><a href="PFLO.html#event:spa_init">PFLO#event:spa_init</a></li><li><a href="PFLO.html#event:spa_navigation">PFLO#event:spa_navigation</a></li><li><a href="PFLO.html#event:visibility_changed">PFLO#event:visibility_changed</a></li><li><a href="PFLO.html#event:xhr_error">PFLO#event:xhr_error</a></li><li><a href="PFLO.html#event:xhr_init">PFLO#event:xhr_init</a></li><li><a href="PFLO.html#event:xhr_load">PFLO#event:xhr_load</a></li><li><a href="PFLO.html#event:xhr_send">PFLO#event:xhr_send</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-README.template.html">README.template</a></li><li><a href="tutorial-building.html">Building</a></li><li><a href="tutorial-contributing.html">Contributing</a></li><li><a href="tutorial-creating-plugins.html">Creating Plugins</a></li><li><a href="tutorial-header-snippets.html">Header Snippets</a></li><li><a href="tutorial-howtos.html">How-Tos</a></li><li><a href="tutorial-loader-snippet.html">Non-Blocking Loader Snippet</a></li><li><a href="tutorial-methodology.html">Methodology</a></li><li><a href="tutorial-page-overrides.html">Page Overrides</a></li><li><a href="tutorial-perf-tests.html">Performance Tests</a></li><li><a href="tutorial-tests.html">Tests</a></li><li><a href="tutorial-version-history.html">Version History</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#PFLO_check_doc_domain">PFLO_check_doc_domain</a></li><li><a href="global.html#PFLO_lstart">PFLO_lstart</a></li><li><a href="global.html#PFLO_onload">PFLO_onload</a></li><li><a href="global.html#PFLO_start">PFLO_start</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    <h1>Reading data from a beacon</h1>
</header>

<article>
    <p>While PageFlo excels at collecting Real User Monitoring performance metrics,
you'll probably want to do something with the data that it collects.</p>
<p>What can you do with the data?</p>
<h2>Beacon results back to your server</h2>
<p>For most cases you'll want to send the collected performance data back to your
server or to the cloud so you can analyze it in aggregate.</p>
<p>The first thing you need to do is configure a url that beacon data will be sent to.</p>
<p>The beacon URL can be configured via the <a href="PFLO.html#.init"><code>beacon_url</code></a> parameter
of <a href="PFLO.html#.init"><code>PFLO.init</code></a>:</p>
<pre class="prettyprint source lang-html"><code>&lt;script src=&quot;pflo.js&quot;>&lt;/script>
&lt;script>
PFLO.init({
  beacon_url: &quot;http://yoursite.com/beacon/&quot;
});
&lt;/script>
</code></pre>
<p><code>beacon_url</code> should be a HTTP(s) endpoint that accepts beacon data encoded in
the query string (via <code>&lt;IMG&gt;</code> <code>GET</code> requests) and <code>application/x-www-form-urlencoded</code>
form data (via <code>POST</code> requests from <code>XMLHttpRequest</code> or <code>navigator.sendBeacon()</code>).</p>
<h3>Beacon Parameters</h3>
<p><a href="PFLO.html"><code>PageFlo</code></a> and each <a href="PFLO.plugins.html"><code>plugin</code></a> adds its own parameters to
the beacon.  Please refer to those documentation pages for details.</p>
<h3>Backend Servers</h3>
<p>There are several open-source projects that can receive and analyze PageFlo data:</p>
<ul>
<li><a href="http://cruft.io/posts/introducing-boomcatch/">boomcatch</a></li>
<li><a href="https://github.com/andreas-marschke/pflo-express">pflo-express</a></li>
<li><a href="https://piwik.org/">PIWIK</a></li>
<li><a href="https://github.com/basicrum/backoffice">Backoffice of Basic RUM</a></li>
<li><a href="https://github.com/basicrum/pflo-beacon-catcher">PageFlo Beacon Catcher of Basic RUM</a></li>
<li><a href="https://github.com/NovatecConsulting/pflo-opentelemetry-plugin">PageFlo-OpenTelemetry Plugin</a></li>
<li><a href="https://www.drupal.org/project/pflo">PageFlo Drupal Module</a></li>
<li><a href="https://openacs.org/xowiki/pflo">PageFlo OpenACS plugin</a></li>
</ul>
<p>Here are some articles for putting it all together:</p>
<ul>
<li><a href="https://www.tollmanz.com/rum-monitoring-pflo-boomcatch-datadog/%5D">A Low Cost Performance Monitoring Setup with PageFlo, Boomcatch, and Datadog</a></li>
<li><a href="https://inspectit.github.io/inspectit-ocelot/docs/enduser-monitoring/enduser-monitoring-server">End User Monitoring with Ocelot</a></li>
<li><a href="https://medium.com/@sunitj/real-user-measurement-using-pflo-boomcatch-statsd-and-graphite-setup-guide-a2f60b5cb082">Real User Monitoring using PageFlo, Boomcatch, StatsD, and Graphite — Setup guide</a></li>
</ul>
<h3>Protecting the Beacon from Abuse</h3>
<p>There are two types of beacon abuse you may need to protect against:</p>
<ul>
<li>Denial of Service (DoS) attacks</li>
<li>Fake beacons that do not originate from a page you own</li>
</ul>
<h4>Denial of Service (DoS) attacks</h4>
<p>There's nothing you can do in JavaScript to prevent Denial of Service (DoS) attacks,
but you can configure your server to rate limit beacons originating from a single
IP.  You typically shouldn't be receiving beacons faster than a user can navigate
through your website.  However, you may need to allow for multiple users originating
from the same proxy IP address.</p>
<p>You'll also want to do some operating system/web server level configuration to
detect abusive access patterns.  The majority of these are beyond the scope of
this document, but we have a few tips on building your back-end to protect you
from an attack.</p>
<p>One recommendation is to have a lightweight web server running as your beacon
endpoint, and have this server quickly log the request and immediately respond
without processing the data.  You can send a HTTP <code>204 No Content</code> response and
close the connection so there is minimal overhead.</p>
<p>Once the data is logged, you can periodically batch process and analyze the
incoming data.</p>
<p>More references for preventing DoS attacks:</p>
<ul>
<li><a href="http://learn-networking.com/network-security/how-to-prevent-denial-of-service-attacks">learn-netowrking.com</a></li>
<li><a href="http://en.wikipedia.org/wiki/Denial-of-service_attack">wikipedia.org</a></li>
<li><a href="http://www.cert.org/tech_tips/denial_of_service.html">cert.org</a></li>
</ul>
<h4>Fake beacons that do not originate from a page you own</h4>
<p>The most common reason for this kind of abuse is that someone liked your page
design and copied it to their own server, including the pflo JavaScript --
only they didn't update the <code>beacon_url</code>, so it still beacons to your server.  You
probably don't want these beacons.</p>
<p>The easiest way to fix this is to just check the HTTP referrer of all requests and
block any that don't come from your own domain.  This works for the clueless
abuser case, but not for the intentional abuser.</p>
<p>The intentional abuser is someone who will try to exploit URLs on your site
to see if they can get something out of it.  What they try isn't really important --
there's only one legitimate way of using your beacon, and you should block all
other uses.  The best way to do this is through a
<a href="http://en.wikipedia.org/wiki/Cryptographic_nonce">nonce</a> or a
<a href="http://abhinavsingh.com/blog/2009/10/web-security-using-crumbs-to-protect-your-php-api-ajax-call-from-cross-site-request-forgery-csrfxsrf-and-other-vulnerabilities/">crumb</a>.</p>
<p>This is a string that is valid for one use only.  It probably includes the
current timestamp and a validity period as part of its hash.  You generate it
on every page request and add it to PageFlo using <a href="PFLO.html#.addVar"><code>PFLO.addVar</code></a>.</p>
<p>On your beacon endpoint, you then validate the nonce before accepting the beacon.</p>
<p>You can either include this nonce in your (non-cached) HTML page, or, fetch it
from your server via a <code>XMLHttpRequest</code>.</p>
<p>The nonce also doesn't protect you from someone pulling the beacon out of your
page (with a valid nonce), then modifying the beacon parameters and sending
it off to your server.  Protecting against this requires you to sign the
parameters in the beacon, but this isn't something that you can do in JavaScript
in a way that an attacker couldn't replicate.</p>
<h2>Read beacon data from JavaScript</h2>
<p>You can get a notification of each beacon before it is sent by subscribing to
the <a href="PFLO.html#event:before_beacon"><code>before_beacon</code></a> event:</p>
<pre class="prettyprint source lang-javascript"><code>PFLO.subscribe('before_beacon', function(beaconData) {
  if (beaconData.u.indexOf(&quot;/some/page&quot;)) {
    // take some action based on the page
  }

  // you can still add data to the beacon at this point
  beaconData.someData = 1;
});
</code></pre>
<p>You can also get a notification of each beacon after it was sent by subscribing to
the <a href="PFLO.html#event:beacon"><code>beacon</code></a> event:</p>
<pre class="prettyprint source lang-javascript"><code>PFLO.subscribe('beacon', function(beaconData) {
  // remove beacon data that was only relevant for a single beacon
  PFLO.removeVar('someData');
});
</code></pre>
<h2>References</h2>
<ul>
<li>
<p><a href="http://www.slideshare.net/bluesmoon/scaling-mysql-writes-through-partitioning-ipc-spring-edition">IPC Berlin 2010 talk on MySQL scaling via Philip Tellis</a></p>
</li>
<li>
<p><a href="http://www.slideshare.net/bluesmoon/index-3441823">ConFoo 2010 talk on the statistics of web performance via Philip Tellis</a></p>
</li>
</ul>
</article>



</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	© 2010-2021 doFlo, Inc.
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a>
	
		on Fri Aug 13th 2021
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>